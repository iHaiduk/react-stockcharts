{"version":3,"sources":["../../../src/lib/tooltip/HoverTooltip.js"],"names":["HoverTooltip","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","pointer","helper","height","context","bgFill","bgOpacity","backgroundShapeSVG","tooltipSVG","bgheight","bgwidth","x","y","content","centerX","pointWidth","bgSize","bgShape","width","contextTypes","margin","object","isRequired","ratio","number","defaultProps","tooltipCanvas","origin","fill","stroke","fontFill","opacity","backgroundShapeCanvas","fontFamily","fontSize","PADDING","X","Y","tspans","startY","i","length","textY","push","label","value","fillStyle","strokeStyle","beginPath","rect","font","textAlign","fillText","measureText","originX","left","originY","top","save","setTransform","scale","translate","restore","calculateTooltipSize","canvas","document","createElement","getContext","str","map","reduce","res","size","sumSizes","String","sizes","Math","max","d","normalizeX","normalizeY","chartId","yAccessor","mouseXY","xAccessor","currentItem","xScale","chartConfig","xValue","round","findIndex","yValue","chartIndex","id","yScale","show","plotData","tooltipContent","displayXAccessor","abs"],"mappings":"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","file":"HoverTooltip.js","sourcesContent":["\"use strict\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport GenericComponent from \"../GenericComponent\";\nimport { sum } from \"d3-array\";\n\nimport { first, last, isNotDefined, isDefined, hexToRGBA } from \"../utils\";\n\nclass HoverTooltip extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tconst pointer = helper(this.props, moreProps, ctx);\n\t\tconst { height } = moreProps;\n\n\t\tif (isNotDefined(pointer)) return null;\n\t\tdrawOnCanvas(ctx, this.props, this.context, pointer, height, moreProps);\n\t}\n\trender() {\n\t\treturn <GenericComponent\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tdrawOn={[\"mousemove\", \"pan\"/* , \"mouseleave\" */]}\n\t\t/>;\n\t}\n\trenderSVG(moreProps) {\n\t\tconst pointer = helper(this.props, moreProps);\n\n\t\tif (isNotDefined(pointer)) return null;\n\n\t\tconst { bgFill, bgOpacity, backgroundShapeSVG, tooltipSVG } = this.props;\n\t\tconst { bgheight, bgwidth } = this.props;\n\t\tconst { height } = moreProps;\n\n\t\tconst { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n\t\tconst bgShape = isDefined(bgwidth) && isDefined(bgheight)\n\t\t\t? { width: bgwidth, height: bgheight }\n\t\t\t: bgSize;\n\n\t\treturn (\n\t\t\t<g>\n\t\t\t\t<rect x={centerX - pointWidth / 2}\n\t\t\t\t\ty={0}\n\t\t\t\t\twidth={pointWidth}\n\t\t\t\t\theight={height}\n\t\t\t\t\tfill={bgFill}\n\t\t\t\t\topacity={bgOpacity} />\n\t\t\t\t<g className=\"react-stockcharts-tooltip-content\" transform={`translate(${x}, ${y})`}>\n\t\t\t\t\t{backgroundShapeSVG(this.props, bgShape)}\n\t\t\t\t\t{tooltipSVG(this.props, content)}\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t);\n\t}\n}\n\nHoverTooltip.propTypes = {\n\tchartId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\tyAccessor: PropTypes.func,\n\ttooltipSVG: PropTypes.func,\n\tbackgroundShapeSVG: PropTypes.func,\n\tbgwidth: PropTypes.number,\n\tbgheight: PropTypes.number,\n\tbgFill: PropTypes.string.isRequired,\n\tbgOpacity: PropTypes.number.isRequired,\n\ttooltipContent: PropTypes.func.isRequired,\n\torigin: PropTypes.oneOfType([\n\t\tPropTypes.array,\n\t\tPropTypes.func\n\t]).isRequired,\n\tfontFamily: PropTypes.string,\n\tfontSize: PropTypes.number,\n};\n\nHoverTooltip.contextTypes = {\n\tmargin: PropTypes.object.isRequired,\n\tratio: PropTypes.number.isRequired,\n};\n\nHoverTooltip.defaultProps = {\n\t// bgwidth: 150,\n\t// bgheight: 50,\n\ttooltipSVG: tooltipSVG,\n\ttooltipCanvas: tooltipCanvas,\n\torigin: origin,\n\tfill: \"#D4E2FD\",\n\tbgFill: \"#D4E2FD\",\n\tbgOpacity: 0.5,\n\tstroke: \"#9B9BFF\",\n\tfontFill: \"#000000\",\n\topacity: 0.8,\n\tbackgroundShapeSVG: backgroundShapeSVG,\n\tbackgroundShapeCanvas: backgroundShapeCanvas,\n\tfontFamily: \"Helvetica Neue, Helvetica, Arial, sans-serif\",\n\tfontSize: 12,\n};\n\nconst PADDING = 5;\nconst X = 10;\nconst Y = 10;\n\n\n/* eslint-disable react/prop-types */\nfunction backgroundShapeSVG({ fill, stroke, opacity }, { height, width }) {\n\treturn <rect\n\t\theight={height}\n\t\twidth={width}\n\t\tfill={fill}\n\t\topacity={opacity}\n\t\tstroke={stroke} />;\n}\n\nfunction tooltipSVG({ fontFamily, fontSize, fontFill }, content) {\n\tconst tspans = [];\n\tconst startY = Y + fontSize * 0.9;\n\n\tfor (let i = 0; i < content.y.length; i++) {\n\t\tconst y = content.y[i];\n\t\tconst textY = startY + (fontSize * (i + 1));\n\n\t\ttspans.push(<tspan key={`L-${i}`} x={X} y={textY} fill={y.stroke}>{y.label}</tspan>);\n\t\ttspans.push(<tspan key={i}>: </tspan>);\n\t\ttspans.push(<tspan key={`V-${i}`}>{y.value}</tspan>);\n\t}\n\treturn <text fontFamily={fontFamily} fontSize={fontSize} fill={fontFill}>\n\t\t<tspan x={X} y={startY}>{content.x}</tspan>\n\t\t{tspans}\n\t</text>;\n}\n/* eslint-enable react/prop-types */\n\nfunction backgroundShapeCanvas(props, { width, height }, ctx) {\n\tconst { fill, stroke, opacity } = props;\n\n\tctx.fillStyle = hexToRGBA(fill, opacity);\n\tctx.strokeStyle = stroke;\n\tctx.beginPath();\n\tctx.rect(0, 0, width, height);\n\tctx.fill();\n\tctx.stroke();\n}\n\nfunction tooltipCanvas({ fontFamily, fontSize, fontFill }, content, ctx) {\n\tconst startY = Y + fontSize * 0.9;\n\tctx.font = `${fontSize}px ${fontFamily}`;\n\tctx.fillStyle = fontFill;\n\tctx.textAlign = \"left\";\n\tctx.fillText(content.x, X, startY);\n\n\tfor (let i = 0; i < content.y.length; i++) {\n\t\tconst y = content.y[i];\n\t\tconst textY = startY + (fontSize * (i + 1));\n\t\tctx.fillStyle = y.stroke || fontFill;\n\t\tctx.fillText(y.label, X, textY);\n\n\t\tctx.fillStyle = fontFill;\n\t\tctx.fillText(\": \" + y.value, X + ctx.measureText(y.label).width, textY);\n\t}\n}\n\nfunction drawOnCanvas(ctx, props, context, pointer, height) {\n\n\tconst { margin, ratio } = context;\n\tconst { bgFill, bgOpacity } = props;\n\tconst { backgroundShapeCanvas, tooltipCanvas } = props;\n\n\tconst originX = 0.5 * ratio + margin.left;\n\tconst originY = 0.5 * ratio + margin.top;\n\n\tctx.save();\n\n\tctx.setTransform(1, 0, 0, 1, 0, 0);\n\tctx.scale(ratio, ratio);\n\n\tctx.translate(originX, originY);\n\n\tconst { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n\tctx.fillStyle = hexToRGBA(bgFill, bgOpacity);\n\tctx.beginPath();\n\tctx.rect(centerX - pointWidth / 2, 0, pointWidth, height);\n\tctx.fill();\n\n\tctx.translate(x, y);\n\tbackgroundShapeCanvas(props, bgSize, ctx);\n\ttooltipCanvas(props, content, ctx);\n\n\tctx.restore();\n}\n\nfunction calculateTooltipSize({ fontFamily, fontSize, fontFill }, content, ctx) {\n\tif (isNotDefined(ctx)) {\n\t\tconst canvas = document.createElement(\"canvas\");\n\t\tctx = canvas.getContext(\"2d\");\n\t}\n\n\tctx.font = `${fontSize}px ${fontFamily}`;\n\tctx.fillStyle = fontFill;\n\tctx.textAlign = \"left\";\n\n\tconst measureText = str => ({\n\t\twidth: ctx.measureText(str).width,\n\t\theight: fontSize,\n\t});\n\n\tconst { width, height } = content.y\n\t\t.map(({ label, value }) => measureText(`${label}: ${value}`))\n\t\t// Sum all y and x sizes (begin with x label size)\n\t\t.reduce((res, size) => sumSizes(res, size), measureText(String(content.x)))\n\t;\n\n\treturn {\n\t\twidth: width + 2 * X,\n\t\theight: height + 2 * Y\n\t};\n}\n\nfunction sumSizes(...sizes) {\n\treturn {\n\t\twidth: Math.max(...sizes.map(size => size.width)),\n\t\theight: sum(sizes, d => d.height),\n\t};\n}\n\nfunction normalizeX(x, bgSize, pointWidth, width) {\n\t// return x - bgSize.width - pointWidth / 2 - PADDING * 2 < 0\n\treturn x < width / 2\n\t\t? x + pointWidth / 2 + PADDING\n\t\t: x - bgSize.width - pointWidth / 2 - PADDING;\n}\n\nfunction normalizeY(y, bgSize) {\n\treturn y - bgSize.height <= 0\n\t\t? y + PADDING\n\t\t: y - bgSize.height - PADDING;\n}\n\nfunction origin(props, moreProps, bgSize, pointWidth) {\n\tconst { chartId, yAccessor } = props;\n\tconst { mouseXY, xAccessor, currentItem, xScale, chartConfig, width } = moreProps;\n\tlet y = last(mouseXY);\n\n\tconst xValue = xAccessor(currentItem);\n\tlet x = Math.round(xScale(xValue));\n\n\tif (isDefined(chartId) && isDefined(yAccessor)\n\t\t\t&& isDefined(chartConfig) && isDefined(chartConfig.findIndex)) {\n\t\tconst yValue = yAccessor(currentItem);\n\t\tconst chartIndex = chartConfig.findIndex(x => x.id === chartId);\n\n\t\ty = Math.round(chartConfig[chartIndex].yScale(yValue));\n\t}\n\n\tx = normalizeX(x, bgSize, pointWidth, width);\n\ty = normalizeY(y, bgSize);\n\n\treturn [x, y];\n}\n\nfunction helper(props, moreProps, ctx) {\n\tconst { show, xScale, currentItem, plotData } = moreProps;\n\tconst { origin, tooltipContent } = props;\n\tconst { xAccessor, displayXAccessor } = moreProps;\n\n\tif (!show || isNotDefined(currentItem)) return;\n\n\tconst xValue = xAccessor(currentItem);\n\n\tif (!show || isNotDefined(xValue)) return;\n\n\tconst content = tooltipContent({ currentItem, xAccessor: displayXAccessor });\n\tconst centerX = xScale(xValue);\n\tconst pointWidth = Math.abs(xScale(xAccessor(last(plotData))) - xScale(xAccessor(first(plotData)))) / (plotData.length - 1);\n\n\tconst bgSize = calculateTooltipSize(props, content, ctx);\n\n\tconst [x, y] = origin(props, moreProps, bgSize, pointWidth);\n\n\treturn { x, y, content, centerX, pointWidth, bgSize };\n}\n\nexport default HoverTooltip;\n"]}