{"version":3,"sources":["../../../../src/lib/series/CandlestickSeries.js"],"names":["nest","React","Component","PropTypes","GenericChartComponent","getAxisCanvas","hexToRGBA","isDefined","functor","plotDataLengthBarWidth","head","CandlestickSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","className","wickClassName","candleClassName","xScale","yScale","chartConfig","plotData","xAccessor","candleData","getCandleData","getWicksSVG","getCandlesSVG","clip","defaultProps","yAccessor","open","d","high","low","close","classNames","width","wickStroke","fill","stroke","candleStrokeWidth","widthRatio","opacity","wicks","map","each","idx","wick","x","y1","y2","y3","y4","candles","y","height","wickNest","key","entries","forEach","outer","values","strokeStyle","fillStyle","fillRect","candleNest","strokeKey","strokeValues","lineWidth","inner","strokeRect","wickStrokeProp","fillProp","strokeProp","widthFunctor","trueOffset","offset","Math","round","floor","i","length","ohlc","max","abs","push","direction"],"mappings":"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","file":"CandlestickSeries.js","sourcesContent":["\"use strict\";\n\nimport { nest } from \"d3-collection\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport {\n\thexToRGBA, isDefined, functor, plotDataLengthBarWidth, head\n} from \"../utils\";\n\nclass CandlestickSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tdrawOnCanvas(ctx, this.props, moreProps);\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { className, wickClassName, candleClassName } = this.props;\n\t\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t\tconst candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\n\n\t\treturn <g className={className}>\n\t\t\t<g className={wickClassName} key=\"wicks\">\n\t\t\t\t{getWicksSVG(candleData)}\n\t\t\t</g>\n\t\t\t<g className={candleClassName} key=\"candles\">\n\t\t\t\t{getCandlesSVG(this.props, candleData)}\n\t\t\t</g>\n\t\t</g>;\n\t}\n\n\trender() {\n\t\tconst { clip } = this.props;\n\t\treturn <GenericChartComponent\n\t\t\tclip={clip}\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n}\n\nCandlestickSeries.propTypes = {\n\tclassName: PropTypes.string,\n\twickClassName: PropTypes.string,\n\tcandleClassName: PropTypes.string,\n\twidthRatio: PropTypes.number,\n\twidth: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func\n\t]),\n\tclassNames: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tfill: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tstroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\twickStroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tyAccessor: PropTypes.func,\n\tclip: PropTypes.bool,\n};\n\nCandlestickSeries.defaultProps = {\n\tclassName: \"react-stockcharts-candlestick\",\n\twickClassName: \"react-stockcharts-candlestick-wick\",\n\tcandleClassName: \"react-stockcharts-candlestick-candle\",\n\tyAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\n\tclassNames: d => d.close > d.open ? \"up\" : \"down\",\n\twidth: plotDataLengthBarWidth,\n\twickStroke: \"#000000\",\n\t// wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tfill: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\t// stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tstroke: \"#000000\",\n\tcandleStrokeWidth: 0.5,\n\t// stroke: \"none\",\n\twidthRatio: 0.8,\n\topacity: 0.5,\n\tclip: true,\n};\n\nfunction getWicksSVG(candleData) {\n\n\tconst wicks = candleData\n\t\t.map((each, idx) => {\n\t\t\tconst d = each.wick;\n\t\t\treturn <path key={idx}\n\t\t\t\tclassName={each.className}\n\t\t\t\tstroke={d.stroke}\n\t\t\t\td={`M${d.x},${d.y1} L${d.x},${d.y2} M${d.x},${d.y3} L${d.x},${d.y4}`} />;\n\t\t});\n\n\treturn wicks;\n}\n\nfunction getCandlesSVG(props, candleData) {\n\n\t/* eslint-disable react/prop-types */\n\tconst { opacity, candleStrokeWidth } = props;\n\t/* eslint-enable react/prop-types */\n\n\tconst candles = candleData.map((d, idx) => {\n\t\tif (d.width <= 1)\n\t\t\treturn (\n\t\t\t\t<line className={d.className} key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill} />\n\t\t\t);\n\t\telse if (d.height === 0)\n\t\t\treturn (\n\t\t\t\t<line key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill} />\n\t\t\t);\n\t\treturn (\n\t\t\t<rect key={idx} className={d.className}\n\t\t\t\tfillOpacity={opacity}\n\t\t\t\tx={d.x} y={d.y} width={d.width} height={d.height}\n\t\t\t\tfill={d.fill} stroke={d.stroke} strokeWidth={candleStrokeWidth} />\n\t\t);\n\t});\n\treturn candles;\n}\n\nfunction drawOnCanvas(ctx, props, moreProps) {\n\tconst { opacity, candleStrokeWidth } = props;\n\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t// const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\n\tconst candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst wickNest = nest()\n\t\t.key(d => d.wick.stroke)\n\t\t.entries(candleData);\n\n\twickNest.forEach(outer => {\n\t\tconst { key, values } = outer;\n\t\tctx.strokeStyle = key;\n\t\tctx.fillStyle = key;\n\t\tvalues.forEach(each => {\n\t\t\t/*\n\t\t\tctx.moveTo(d.x, d.y1);\n\t\t\tctx.lineTo(d.x, d.y2);\n\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(d.x, d.y3);\n\t\t\tctx.lineTo(d.x, d.y4);\n\t\t\tctx.stroke(); */\n\t\t\tconst d = each.wick;\n\n\t\t\tctx.fillRect(d.x - 0.5, d.y1, 1, d.y2 - d.y1);\n\t\t\tctx.fillRect(d.x - 0.5, d.y3, 1, d.y4 - d.y3);\n\t\t});\n\t});\n\n\t// const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst candleNest = nest()\n\t\t.key(d => d.stroke)\n\t\t.key(d => d.fill)\n\t\t.entries(candleData);\n\n\n\tcandleNest.forEach(outer => {\n\t\tconst { key: strokeKey, values: strokeValues } = outer;\n\t\tif (strokeKey !== \"none\") {\n\t\t\tctx.strokeStyle = strokeKey;\n\t\t\tctx.lineWidth = candleStrokeWidth;\n\t\t}\n\t\tstrokeValues.forEach(inner => {\n\t\t\tconst { key, values } = inner;\n\t\t\tconst fillStyle = head(values).width <= 1\n\t\t\t\t? key\n\t\t\t\t: hexToRGBA(key, opacity);\n\t\t\tctx.fillStyle = fillStyle;\n\n\t\t\tvalues.forEach(d => {\n\t\t\t\tif (d.width <= 1) {\n\t\t\t\t\t// <line className={d.className} key={idx} x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}/>\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(d.x, d.y);\n\t\t\t\t\tctx.lineTo(d.x, d.y + d.height);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x - 0.5, d.y, 1, d.height);\n\t\t\t\t} else if (d.height === 0) {\n\t\t\t\t\t// <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(d.x, d.y);\n\t\t\t\t\tctx.lineTo(d.x + d.width, d.y + d.height);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y - 0.5, d.width, 1);\n\t\t\t\t} else {\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.rect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tctx.closePath();\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n}\n/*\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\tconst className = functor(classNameProp);\n\tconst wickData = plotData\n\t\t\t.filter(d => isDefined(yAccessor(d).close))\n\t\t\t.map(d => {\n\t\t\t\t// console.log(yAccessor);\n\t\t\t\tconst ohlc = yAccessor(d);\n\n\t\t\t\tconst x = Math.round(xScale(xAccessor(d))),\n\t\t\t\t\ty1 = yScale(ohlc.high),\n\t\t\t\t\ty2 = yScale(Math.max(ohlc.open, ohlc.close)),\n\t\t\t\t\ty3 = yScale(Math.min(ohlc.open, ohlc.close)),\n\t\t\t\t\ty4 = yScale(ohlc.low);\n\n\t\t\t\treturn {\n\t\t\t\t\tx,\n\t\t\t\t\ty1,\n\t\t\t\t\ty2,\n\t\t\t\t\ty3,\n\t\t\t\t\ty4,\n\t\t\t\t\tclassName: className(ohlc),\n\t\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t};\n\t\t\t});\n\treturn wickData;\n}\n*/\n\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { wickStroke: wickStrokeProp } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\n\tconst { classNames, fill: fillProp, stroke: strokeProp, yAccessor } = props;\n\tconst className = functor(classNames);\n\n\tconst fill = functor(fillProp);\n\tconst stroke = functor(strokeProp);\n\n\tconst widthFunctor = functor(props.width);\n\tconst width = widthFunctor(props, {\n\t\txScale,\n\t\txAccessor,\n\t\tplotData\n\t});\n\n\t/*\n\tconst candleWidth = Math.round(width);\n\tconst offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\n\t*/\n\tconst trueOffset = 0.5 * width;\n\tconst offset = trueOffset > 0.7\n\t\t? Math.round(trueOffset)\n\t\t: Math.floor(trueOffset);\n\n\t// eslint-disable-next-line prefer-const\n\tlet candles = [];\n\n\tfor (let i = 0; i < plotData.length; i++) {\n\t\tconst d = plotData[i];\n\t\tif (isDefined(yAccessor(d).close)) {\n\t\t\tconst x = Math.round(xScale(xAccessor(d)));\n\t\t\t// const x = Math.round(xScale(xAccessor(d)) - offset);\n\n\t\t\tconst ohlc = yAccessor(d);\n\t\t\tconst y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\n\t\t\tconst height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\n\n\t\t\tcandles.push({\n\t\t\t\t// type: \"line\"\n\t\t\t\tx: x - offset,\n\t\t\t\ty: y,\n\t\t\t\twick: {\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t\tx: x,\n\t\t\t\t\ty1: Math.round(yScale(ohlc.high)),\n\t\t\t\t\ty2: y,\n\t\t\t\t\ty3: y + height, // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\n\t\t\t\t\ty4: Math.round(yScale(ohlc.low)),\n\t\t\t\t},\n\t\t\t\theight: height,\n\t\t\t\twidth: offset * 2,\n\t\t\t\tclassName: className(ohlc),\n\t\t\t\tfill: fill(ohlc),\n\t\t\t\tstroke: stroke(ohlc),\n\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t});\n\t\t}\n\t}\n\n\treturn candles;\n}\n\nexport default CandlestickSeries;\n"]}