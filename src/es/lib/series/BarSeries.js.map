{"version":3,"sources":["../../../../src/lib/series/BarSeries.js"],"names":["React","Component","PropTypes","GenericChartComponent","getAxisCanvas","StackedBarSeries","drawOnCanvasHelper","drawOnCanvas2","getBarsSVG2","svgHelper","identityStack","functor","BarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","swapScales","xAccessor","bars","getBars","clip","defaultProps","baseAt","fill","stroke","yAccessor","xScale","plotData","yScale","chartConfig","getFill","getBase","widthFunctor","width","offset","Math","floor","map","yValue","d","y","x","round","h","height"],"mappings":"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","file":"BarSeries.js","sourcesContent":["\"use strict\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport StackedBarSeries, {\n\tdrawOnCanvasHelper,\n\tdrawOnCanvas2,\n\tgetBarsSVG2,\n\tsvgHelper,\n\tidentityStack\n} from \"./StackedBarSeries\";\n\nimport { functor } from \"../utils\";\n\nclass BarSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\n\t\tif (this.props.swapScales) {\n\t\t\tconst { xAccessor } = moreProps;\n\t\t\tdrawOnCanvasHelper(ctx, this.props, moreProps, xAccessor, identityStack);\n\t\t} else {\n\t\t\tconst bars = getBars(this.props, moreProps);\n\t\t\tdrawOnCanvas2(this.props, ctx, bars);\n\t\t}\n\n\t}\n\trenderSVG(moreProps) {\n\t\tif (this.props.swapScales) {\n\t\t\tconst { xAccessor } = moreProps;\n\t\t\treturn <g>{svgHelper(this.props, moreProps, xAccessor, identityStack)}</g>;\n\t\t} else {\n\t\t\tconst bars = getBars(this.props, moreProps);\n\t\t\treturn <g>{getBarsSVG2(this.props, bars)}</g>;\n\t\t}\n\n\t}\n\trender() {\n\t\tconst { clip } = this.props;\n\n\t\treturn <GenericChartComponent\n\t\t\tclip={clip}\n\t\t\tsvgDraw={this.renderSVG}\n\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n}\n\nBarSeries.propTypes = {\n\tbaseAt: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func,\n\t]),\n\tstroke: PropTypes.bool,\n\twidth: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func\n\t]),\n\tyAccessor: PropTypes.func.isRequired,\n\topacity: PropTypes.number,\n\tfill: PropTypes.oneOfType([\n\t\tPropTypes.func, PropTypes.string\n\t]),\n\tclassName: PropTypes.oneOfType([\n\t\tPropTypes.func, PropTypes.string\n\t]),\n\tclip: PropTypes.bool,\n\tswapScales: PropTypes.bool,\n};\n\n\nBarSeries.defaultProps = StackedBarSeries.defaultProps;\n\nexport default BarSeries;\n\n/*\n Initially, this program was using StackedBarSeries.getBars\n to benefit from code reuse and having a single place that\n contains the logic for drawing all types of bar charts\n simple, grouped, horizontal, but turnes out\n making it highly cuztimizable also made it slow for the\n most simple case, a regular bar chart.\n This function contains just the necessary logic\n to create bars\n*/\nfunction getBars(props, moreProps) {\n\tconst { baseAt, fill, stroke, yAccessor } = props;\n\tconst { xScale, xAccessor, plotData, chartConfig: { yScale } } = moreProps;\n\n\tconst getFill = functor(fill);\n\tconst getBase = functor(baseAt);\n\n\tconst widthFunctor = functor(props.width);\n\n\tconst width = widthFunctor(props, {\n\t\txScale,\n\t\txAccessor,\n\t\tplotData\n\t});\n\n\t/*\n\tconst barWidth = Math.round(width);\n\tconst offset = Math.round(barWidth === 1 ? 0 : 0.5 * barWidth);\n\t*/\n\tconst offset = Math.floor(0.5 * width);\n\n\tconst bars = plotData\n\t\t.map(d => {\n\t\t\tconst yValue = yAccessor(d);\n\t\t\tlet y = yScale(yValue);\n\n\t\t\tconst x = Math.round(xScale(xAccessor(d))) - offset;\n\t\t\tlet h = getBase(xScale, yScale, d) - yScale(yValue);\n\n\t\t\tif (h < 0) {\n\t\t\t\ty = y + h;\n\t\t\t\th = -h;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t// type: \"line\"\n\t\t\t\tx,\n\t\t\t\ty: Math.round(y),\n\t\t\t\theight: Math.round(h),\n\t\t\t\twidth: offset * 2,\n\t\t\t\tfill: getFill(d, 0),\n\t\t\t\tstroke: stroke ? getFill(d, 0) : \"none\",\n\t\t\t};\n\t\t});\n\n\treturn bars;\n}\n"]}